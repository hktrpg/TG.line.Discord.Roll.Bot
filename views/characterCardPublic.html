<!doctype html>
<html lang="zh-Hant-HK">
<!-- HKTRPG Sad-->

<head>
    <!-- Meta Tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Character Card 公開角色卡 @ HKTRPG</title>
    
    <!-- Favicon -->
    <link rel="icon" href="https://avatars2.githubusercontent.com/u/48795428?s=280&v=4" />
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/card.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    
    <!-- Scripts -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://code.iconify.design/1/1.0.7/iconify.min.js"></script>
</head>

<body class="bg-color center container" id="body">
    <!-- Header Section -->
    <header>
        <div id="header"></div>
    </header>

    <!-- Main Content -->
    <main class="container" id="array-rendering">
        <!-- Action Buttons Section -->
        <section id="buttonlist">
            <div class="button-group">
                <button type="button" class="btn btn-secondary float-right" onclick="selectCard()">
                    <span class="iconify" data-icon="grommet-icons:select" data-inline="false"></span>選擇角色卡
                </button>
                <button type="button" class="btn btn-dark float-right" onclick="readme()">
                    <span class="iconify" data-icon="gg:readme" data-inline="false"></span>說明
                </button>
            </div>
            <h3>
                <span class="iconify" data-icon="wpf:name" data-inline="false"></span> {{name}}
            </h3>
        </section>

        <!-- Character Attributes Section -->
        <section id="attributeList">
            <h3 class="bg-color3 p-1">
                <span class="iconify" data-icon="carbon:data-base" data-inline="false" data-width="20px" data-height="20px"></span>基本屬性
            </h3>
            <div class="row align-items-start">
                <div v-for="item in state" class="board1" style="height: 36px;">
                    <div>
                        <textarea readonly class="textName" v-model="item.name" style="width:50px;padding: 1px 1px 1px 1px">{{item.name}}</textarea>
                        <span style="height: 62px;">：</span>
                        <textarea readonly class="textState" v-model="item.itemA" style="width:55px;padding: 1px 1px 1px 1px;">{{item.itemA}}</textarea>
                        <span style="height: 32px;">／</span>
                        <textarea readonly class="textState" v-model="item.itemB" style="width:55px;padding: 1px 1px 1px 1px">{{item.itemB}}</textarea>
                        <button type="button" class="btn btn-link" v-on:click="rolling(item.name)">
                            <span class="iconify" data-icon="fa-solid:dice-d20" data-inline="false" data-width="20px" data-height="20px"></span>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dice Roll Section -->
        <section id="rollList">
            <h3 class="bg-color3 p-1">
                <span class="iconify" data-icon="fa-solid:dice-d20" data-inline="false" data-width="20px" data-height="20px"></span>擲骰
            </h3>
            <div class="row align-items-center" id="roll">
                <div v-for="item in roll" class="board1" style="height: 36px;padding: 1px 1px 1px 1px">
                    <textarea readonly class="col textName" v-model="item.name" style="width:80px;padding: 1px 1px 1px 1px">{{item.name}}</textarea>
                    <span class="pb-2">:</span>
                    <textarea readonly class="col textState" v-model="item.itemA" style="width:80px;padding: 1px 1px 1px 1px">{{item.itemA}}</textarea>
                    <button type="button" class="btn btn-link" v-on:click="rolling(item.name)">
                        <span class="iconify" data-icon="fa-solid:dice-d20" data-inline="false" data-width="20px" data-height="20px"></span>
                    </button>
                </div>
            </div>
        </section>

        <!-- Notes Section -->
        <section id="noteList">
            <h3 class="bg-color3 p-1">
                <span class="iconify" data-icon="clarity:note-edit-line" data-inline="false" data-width="20px" data-height="20px"></span>筆記
            </h3>
            <div class="row align-items-end" id="notes">
                <div v-for="item in notes" class="board1">
                    <textarea readonly class="col textName" v-model="item.name" style="width:80px;padding: 1px 1px 1px 1px">{{item.name}}</textarea>：
                    <textarea readonly class="col textNote" v-model="item.itemA" style="width:180px">{{item.itemA}}</textarea>
                </div>
            </div>
        </section>
    </main>

    <!-- Include common modals -->
    <div id="commonModals"></div>

    <!-- Footer -->
    <footer>
        <div id="footer"></div>
    </footer>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"></script>
    
    <!-- Load common code -->
    <script src="/common/characterCardCommon.js"></script>
    <script>
        // Load common modals and initialize Vue after they're loaded
        $(function() {
            $("#commonModals").load("/common/characterCardModals.html", function() {
                debugLog('Modals loaded, initializing Vue apps', 'info');
                initializeVueApps();
            });
        });

        // Public card specific code
        document.getElementById("body").onload = function () {
            debugLog('Body loaded, initializing public card', 'info');
            login();
        };

        function login() {
            debugLog('Attempting to get public list info', 'info');
            socket.emit('getPublicListInfo');
        }

        // Socket event handlers
        socket.on("getPublicListInfo", function (listInfo) {
            debugLog('Received public list info', 'info');
            if (!listInfo || !listInfo.temp) {
                debugLog('No public list info received', 'error');
                return;
            }
            
            let list = listInfo.temp;
            if (list) {
                debugLog(`Found ${list.length} public cards`, 'info');
                if (cardList && cardList.list) {
                    cardList.list = list;
                    $('#loginModal').modal("hide");
                    $('#cardListModal').modal("show");
                } else {
                    debugLog('CardList Vue app not initialized', 'error');
                }
            } else {
                debugLog('No public cards found', 'info');
            }
        });

        socket.on("publicRolling", function (result) {
            if (result) {
                debugLog(`Public rolling result: ${result}`, 'info');
                addElement("<strong>" + result + "</strong>", "warning", 4000);
            }
        });
    </script>
</body>
<!-- HKTRPG Sad -- 20201221-->

</html>